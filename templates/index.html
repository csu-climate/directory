
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Members Directory</title>
  <link rel="stylesheet" href="theme.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-left">
        <img src="{{ base_path }}/static/climate-directory-logo.png" alt="CSU Climate Directory Logo" class="logo">
      </div>
      <h1>CSU-Climate Faculty Directory</h1>
      <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
        <svg class="theme-icon" id="themeIcon" viewBox="0 0 24 24">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
        <span id="themeText">Dark Mode</span>
      </button>
    </div>

    <div class="search-section">
      <input 
        type="text" 
        class="search-bar" 
        placeholder="Search members by name, interests, notes..." 
        id="searchInput"
      >

      <div class="filters">
        <div class="filter-group">
          <label for="college">College</label>
          <select class="filter-select" id="college">
            <option value="">All Colleges</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="department">Department</label>
          <select class="filter-select" id="department">
            <option value="">All Departments</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="title">Title</label>
          <select class="filter-select" id="title">
            <option value="">All Titles</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="campus">Campus</label>
          <select class="filter-select" id="campus">
            <option value="">All Campuses</option>
          </select>
        </div>
      </div>

      <div class="filter-tags" id="activeFilters"></div>
    </div>

    <div class="results-header">
      <h2>Members</h2>
      <div class="results-count" id="resultsCount">Loading...</div>
    </div>

    <div class="lessons-grid" id="cardsGrid"></div>

    <footer class="footer">
      <p>The Initiative for Climate Leadership and Resilience at Cal Poly.</p>
      <p>Facilitating collaboration on climate change solutions.</p>
    </footer>
  </div>

<script>
  // === Theme management (mirrors original index.html) ===
  function setThemeUI(isDark) {
    const themeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');
    if (isDark) {
      // Sun icon indicates you can switch back to light
      themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
      themeText.textContent = 'Light Mode';
    } else {
      // Moon icon indicates you can switch to dark
      themeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
      themeText.textContent = 'Dark Mode';
    }
  }

  function toggleTheme() {
    const body = document.body;
    const willBeDark = !body.classList.contains('dark-theme');
    body.classList.toggle('dark-theme', willBeDark);
    localStorage.setItem('theme', willBeDark ? 'dark' : 'light');
    setThemeUI(willBeDark);
  }

  function loadTheme() {
    const savedTheme = localStorage.getItem('theme');
    const isDark = savedTheme === 'dark';
    document.body.classList.toggle('dark-theme', isDark);
    setThemeUI(isDark);
  }

  // === Directory logic ===
  let MEMBERS = [];

  function uniq(values) {
    return [...new Set(values.filter(Boolean).map(v => v.trim()))].sort((a,b)=>a.localeCompare(b));
  }

  function pillize(str) {
    if (!str) return [];
    return str.split(/[,;]+/).map(s => s.trim()).filter(Boolean);
  }

  function createMemberCard(m) {
    const interests = [...pillize(m['Research Interests']), ...pillize(m['Teaching Interests'])].slice(0, 8);
    const emailHTML = m['Email'] ? `<a href="mailto:${m['Email']}">${m['Email']}</a>` : '';
    const metaBits = [m['Title'], m['Department'], m['College'], m['Campus']].filter(Boolean).join(' Â· ');

    const card = document.createElement('div');
    card.className = 'lesson-card'; // reuse existing card styling
    card.innerHTML = `
      <div class="lesson-title">${m['Name'] || '(No name)'}</div>
      <div class="lesson-description">${metaBits}</div>
      <div class="lesson-meta">
        ${emailHTML ? `<div class="meta-item"><span class="meta-label">Email:</span><span class="meta-value">${emailHTML}</span></div>` : ''}
        ${m['Sustainability Contributions'] ? `<div class="meta-item"><span class="meta-label">Sustainability:</span><span class="meta-value">${m['Sustainability Contributions']}</span></div>` : ''}
        ${m['Notes'] ? `<div class="meta-item"><span class="meta-label">Notes:</span><span class="meta-value">${m['Notes']}</span></div>` : ''}
      </div>
      ${interests.length ? `<div class="lesson-tags">${interests.map(t=>`<span class="tag">${t}</span>`).join('')}</div>` : ''}
    `;
    return card;
  }

  function applyFilters() {
    const q = document.getElementById('searchInput').value.toLowerCase();
    const college = document.getElementById('college').value;
    const department = document.getElementById('department').value;
    const title = document.getElementById('title').value;
    const campus = document.getElementById('campus').value;

    const filtered = MEMBERS.filter(m => {
      const blob = [
        m['Name'], m['Research Interests'], m['Teaching Interests'],
        m['Notes'], m['Sustainability Contributions'], m['College'],
        m['Department'], m['Title'], m['Campus'], m['Email']
      ].join(' ').toLowerCase();
      if (q && !blob.includes(q)) return false;
      if (college && m['College'] !== college) return false;
      if (department && m['Department'] !== department) return false;
      if (title && m['Title'] !== title) return false;
      if (campus && m['Campus'] !== campus) return false;
      return true;
    });

    const grid = document.getElementById('cardsGrid');
    grid.innerHTML = '';
    filtered.forEach(m => grid.appendChild(createMemberCard(m)));

    document.getElementById('resultsCount').textContent = `${filtered.length} of ${MEMBERS.length}`;

    // Render active filter tags
    const tagsEl = document.getElementById('activeFilters');
    tagsEl.innerHTML = '';
    const active = [
      college ? {label:'College', value:college, id:'college'} : null,
      department ? {label:'Department', value:department, id:'department'} : null,
      title ? {label:'Title', value:title, id:'title'} : null,
      campus ? {label:'Campus', value:campus, id:'campus'} : null
    ].filter(Boolean);

    active.forEach(f => {
      const t = document.createElement('span');
      t.className = 'filter-tag';
      t.innerHTML = `<strong>${f.label}:</strong> ${f.value} <button class="remove" aria-label="Clear ${f.label}">&times;</button>`;
      t.querySelector('button').addEventListener('click', () => {
        document.getElementById(f.id).value = '';
        applyFilters();
      });
      tagsEl.appendChild(t);
    });
  }

  async function init() {
    loadTheme();
    const resp = await fetch('data/members.json', {cache: 'no-store'});
    MEMBERS = await resp.json();

    // Populate filter options
    const colleges = uniq(MEMBERS.map(m => m['College']));
    const departments = uniq(MEMBERS.map(m => m['Department']));
    const titles = uniq(MEMBERS.map(m => m['Title']));
    const campuses = uniq(MEMBERS.map(m => m['Campus']));

    function fill(selectId, values) {
      const sel = document.getElementById(selectId);
      const current = sel.value;
      // Keep first option
      const first = sel.querySelector('option:first-child');
      sel.innerHTML = '';
      sel.appendChild(first);
      values.forEach(v => {
        const o = document.createElement('option');
        o.value = v; o.textContent = v;
        sel.appendChild(o);
      });
      if (values.includes(current)) sel.value = current;
      sel.addEventListener('change', applyFilters);
    }

    fill('college', colleges);
    fill('department', departments);
    fill('title', titles);
    fill('campus', campuses);

    document.getElementById('searchInput').addEventListener('input', applyFilters);

    applyFilters();
  }

  init();
</script>
</body>
</html>
