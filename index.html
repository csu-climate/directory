<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Members Directory</title>
  <link rel="stylesheet" href="theme.css" />
  <style>
    .filters { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap: 12px; margin-bottom: 16px; }
    .cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); background: white; }
    .name { font-weight: 600; font-size: 1.1rem; margin-bottom: 4px; }
    .meta { font-size: 0.9rem; color: #374151; margin-bottom: 6px; }
    .pill { display: inline-block; font-size: 0.75rem; padding: 2px 8px; border-radius: 999px; background: #f3f4f6; margin-right: 6px; margin-bottom: 6px; }
    .muted { color: #6b7280; font-size: 0.85rem; }
    .header { display:flex; justify-content: space-between; align-items:center; margin: 24px 0; }
    .header h1 { margin:0; font-size: 1.5rem; }
    .count { font-size:0.9rem; }
    input, select { width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 8px; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:#f9fafb; margin:0; }
    .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Members Directory</h1>
      <div class="count" id="count"></div>
    </div>
    <div class="filters">
      <input id="q" type="search" placeholder="Search name, interests, notes..."/>
      <select id="college"><option value="">All Colleges</option></select>
      <select id="department"><option value="">All Departments</option></select>
      <select id="title"><option value="">All Titles</option></select>
    </div>
    <div class="cards" id="cards"></div>
  </div>

  <script>
    let MEMBERS = [];
    const el = (id) => document.getElementById(id);

    function uniq(values) {
      return [...new Set(values.filter(Boolean).map(v => v.trim()))].sort((a,b)=>a.localeCompare(b));
    }

    function renderOptions(select, values) {
      const current = select.value;
      const first = select.querySelector("option:first-child");
      select.innerHTML = "";
      select.appendChild(first);
      for (const v of values) {
        const opt = document.createElement("option");
        opt.value = v;
        opt.textContent = v;
        select.appendChild(opt);
      }
      if (uniq(values).includes(current)) select.value = current;
    }

    function card(m) {
      const interests = [m["Research Interests"], m["Teaching Interests"]].filter(Boolean);
      const pills = interests.flatMap(s => s.split(/[,;]+/)).map(s => s.trim()).filter(Boolean).slice(0,6);
      return `
        <div class="card">
          <div class="name">${m["Name"]}</div>
          <div class="meta">${m["Title"] || ""}${m["Title"] && (m["Department"]||m["College"]) ? " · " : ""}${m["Department"] || ""}${m["Department"] && m["College"] ? " · " : ""}${m["College"] || ""}</div>
          <div class="muted">${m["Email"] ? `<a href="mailto:${m["Email"]}">${m["Email"]}</a>` : ""}</div>
          ${pills.length ? `<div style="margin-top:8px;">${pills.map(p=>`<span class="pill">${p}</span>`).join("")}</div>` : ""}
          ${m["Sustainability Contributions"] ? `<div class="muted" style="margin-top:8px;"><strong>Sustainability:</strong> ${m["Sustainability Contributions"]}</div>` : ""}
          ${m["Notes"] ? `<div class="muted" style="margin-top:8px;"><strong>Notes:</strong> ${m["Notes"]}</div>` : ""}
        </div>
      `;
    }

    function filterMembers() {
      const q = el("q").value.toLowerCase();
      const college = el("college").value;
      const department = el("department").value;
      const title = el("title").value;

      const filtered = MEMBERS.filter(m => {
        const blob = [m["Name"], m["Research Interests"], m["Teaching Interests"], m["Notes"], m["Sustainability Contributions"]].join(" ").toLowerCase();
        if (q && !blob.includes(q)) return false;
        if (college && m["College"] !== college) return false;
        if (department && m["Department"] !== department) return false;
        if (title && m["Title"] !== title) return false;
        return true;
      });

      el("cards").innerHTML = filtered.map(card).join("");
      el("count").textContent = `${filtered.length} of ${MEMBERS.length}`;
    }

    async function init() {
      const resp = await fetch("data/members.json", {cache:"no-store"});
      MEMBERS = await resp.json();

      // Populate filters
      renderOptions(el("college"), uniq(MEMBERS.map(m=>m["College"])));
      renderOptions(el("department"), uniq(MEMBERS.map(m=>m["Department"])));
      renderOptions(el("title"), uniq(MEMBERS.map(m=>m["Title"])));

      // Wire up events
      ["q","college","department","title"].forEach(id => el(id).addEventListener("input", filterMembers));
      ["college","department","title"].forEach(id => el(id).addEventListener("change", filterMembers));

      filterMembers();
    }
    init();
  </script>
</body>
</html>
